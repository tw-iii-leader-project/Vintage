<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Vintage-管理後臺</title>
<meta name="author" content="www.vintage.tw" >
<!-- Google Font -->
<link
	href="https://fonts.googleapis.com/css?family=Muli:300,400,500,600,700,800,900&display=swap"
	rel="stylesheet">

<!-- Css Styles -->
<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="css/themify-icons.css" type="text/css">
<link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
<link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
<link rel="stylesheet" href="css/nice-select.css" type="text/css">
<link rel="stylesheet" href="css/jquery-ui.min.css" type="text/css">
<link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
<link rel="stylesheet" href="css/style.css" type="text/css">

<script src="https://cdn.jsdelivr.net/npm/vue" type="text/javascript"></script>
<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<style type="text/css">
	div{font-family:Microsoft JhengHei;font-size:20px, text-align:center;vertical-align:middle}
	table{font-family:Microsoft JhengHei;font-size:20px;border:solid 2px black;border-collapse:collapse;width:100%;margin:10px 1px;text-align:center;vertical-align:middle}
	table tr >*{font-family:Microsoft JhengHei;font-size:20px;border:solid 1px blue,padding:5px;border:dotted 1px gray;text-align:center;vertical-align:middle;}
	.ppic{width:150px;height:150px;text-align:center;vertical-align:middle;}
</style>
</head>

<header class="header-section">
		<div class="header-top">
			<div class="container">
				<div class="ht-left"></div>
				<div class="ht-right">
					<a href="logout" class="login-panel" th:text="Logout"><i
						class="fa fa-user"></i></a> <a href="loginPage" class="login-panel"
						th:text="Login"><i class="fa fa-user"></i></a>


					<div class="top-social">
						<div class="mail-service">
							<a class=" fa fa-envelope" id="userPageControl" href="#"
								th:text="${user}"></a>
							<!-- 進入使用者個人資料的頁面(賣家頁面) -->

						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="inner-header">
				<div class="row">
					<div class="col-lg-2 col-md-2">
						<div class="logo">
							<a href="index"> <img src="img/logo.png" alt="">
							</a>
						</div>
					</div>
					<div class="col-lg-7 col-md-7">
						<div class="advanced-search">
							<button type="button" class="category-btn">所　有　分　類　</button>
							<div class="input-group">
								<input type="text" placeholder="您在搜尋什麼商品嗎?">
								<button type="button" class="ml-5">
									<i class="ti-search"></i>
								</button>
							</div>
						</div>
					</div>
					<div class="col-lg-3 text-right col-md-3">
						<ul class="nav-right">

							<li class="cart-icon"><a href="#"> <i
									class="icon_bag_alt"></i> <span>3</span>
							</a>
								<div class="cart-hover">
									<div class="select-items">
										<table>
											<tbody>
												<tr>
													<td class="si-pic"><img src="img/select-product-1.jpg"
														alt=""></td>
													<td class="si-text">
														<div class="product-selected">
															<p>$60.00 x 1</p>
															<h6>Kabino Bedside Table</h6>
														</div>
													</td>
													<td class="si-close"><i class="ti-close"></i></td>
												</tr>
												<tr>
													<td class="si-pic"><img src="img/select-product-2.jpg"
														alt=""></td>
													<td class="si-text">
														<div class="product-selected">
															<p>$60.00 x 1</p>
															<h6>Kabino Bedside Table</h6>
														</div>
													</td>
													<td class="si-close"><i class="ti-close"></i></td>
												</tr>
											</tbody>
										</table>
									</div>
									<div class="select-total">
										<span>總共:</span>
										<h5>$120.00</h5>
									</div>
									<div class="select-button">
										<a href="#" class="primary-btn view-card">購　物　車</a> <a
											href="#" class="primary-btn checkout-btn">結　　　帳</a>
									</div>
								</div></li>
							<li class="cart-price">$150.00</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="nav-item">
			<div class="container">
				<div class="nav-depart">
					<div class="depart-btn">
						<i class="ti-menu"></i> <span>所有選項</span>
						<ul class="depart-hover">
							<li class="testActive"><a href="#">飾　　　　品</a></li>
							<li class="testActive"><a href="#">服　　　　飾</a></li>
							<li class="testActive"><a href="#">生　　　　活</a></li>
							<li class="testActive"><a href="#">玩　　　　具</a></li>
							<li class="testActive"><a href="#">藝　　　　術</a></li>
							<li class="testActive"><a href="#">經　　　　典</a></li>
						</ul>
					</div>
				</div>
				<nav class="nav-menu mobile-menu">
					<ul>
						<li class="active"><a href="index">首　頁</a></li>
						<li><a href="shopPage">商　城</a></li>
						<li><a href="blog">部落格</a></li>
						<li><a href="test">活　動</a></li>
						<li><a href="faq">問與答</a></li>

					</ul>
				</nav>
				<div id="mobile-menu-wrap"></div>
			</div>
		</div>
	</header>

<body>
	<div id="app">
		<fieldset>
			<legend>商品管理：</legend>
			<table>
				<colgroup>
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
					<col style="width:auto">
				</colgroup>
				<tr>
					<th>商品ID</th>
					<th>商品名稱</th>
					<th>商品大類</th>
					<th>商品小類</th>
					<th>價格</th>
					<th>庫存</th>
					<th>尺寸</th>
					<th>商品摘要</th>
					<th>商品標註</th>
					<th>商品圖片</th>
					<th>信箱</th>
					<th>使用者名稱</th>
					<th>類別</th>
					<th>上傳時間</th>
					<th>操作</th>
					<!-- <th>短敘述</th>
					<th>會員email</th>
					<th>會員姓名</th>
					
					<!-- <th>商品圖片</th>
					<th>商品類別</th>
					<th>編輯者</th>
					<th>編輯時間</th>
					<th>操作</th> -->
				</tr>
				<tr style="background-color:orange;">
					<td>{{editproduct.pId}}</td>
					<td><input type="text" v-model="editproduct.pName"></td>
					<td><textarea v-model="editproduct.pMain"></textarea></td>
					<td><textarea v-model="editproduct.pDetail"></textarea></td>
					<td><input type="text" v-model="editproduct.price"></td>
					<td><input type="text" v-model="editproduct.invantory"></td>
					<td><input type="text" v-model="editproduct.pSize"></td>
					<td><textarea v-model="editproduct.description"></textarea></td>
					<td><textarea v-model="editproduct.sDescription"></textarea></td>
					<td><img v-bind:src="editproduct.cPhoto" class="ppic">
					<input class="upload" type="file" id="ppicfile" @change="selectimg($event.target)" accept="image/png,image/gif,image/jpeg"></td>
					<td><input type="text" v-model="editproduct.email"></td>
					<td><input type="text" v-model="editproduct.userName"></td>
					<td>
						<select v-model="editproduct.categoryId">
							<option v-for="c in categorys" v-bind:value="c.id">{{c.categoryName}}</option>
						</select>
					</td>
					<td>{{editproduct.lastEditTime}}</td>
					<td><button @click="saveproduct(editproduct)">保存</button></td>
				</tr>
				<tr v-for="p in products">
					<td>{{p.pId}}</td>
					<td>{{p.pName}}</td>
					<td>{{p.pMain}}</td>
					<td>{{p.pDetail}}</td>
					<td>{{p.price}}</td>
					<td>{{p.invantory}}</td>
					<td>{{p.pSize}}</td>
					<td>{{p.description}}</td>
					<td>{{p.sDescription}}</td>
					<td><img v-bind:src="p.cPhoto" class="ppic"></td>
					<td>{{p.email}}</td>
					<td>{{p.userName}}</td>
					<td>{{p.categoryId}}</td>
					<td>{{p.lastEditTime}}</td>
					<td><button @click="editproduct(p)" >修改</button>&nbsp;|&nbsp;
					<button @click="delproduct(p)">删除</button></td>
		 			<!-- UI暂不实现修改，禁用  -->
				</tr>
			</table>
		</fieldset>
	</div>
	<script type="text/javascript">
		var vm=new Vue({
			el:"#app",
			data:{
				categorys:[],
				products:[],
				editproduct:{
					pId:null,
					pName:null,
					pMain:null,
					pDetail:null,
					price:null,
					invantory:null,
					pSize:null,
					description:null,
					sDescription:null,
					cPhoto:null,
					email:null,
					userName:"",
					categoryId:1,
					lastEditBy:"",
					lastEditTime:null
				}
			},
			created:function(){
				this.$http.get('/api/categorys').then(function(res){
					 this.categorys=res.body;  
	                },function(){
	                	Swal.fire({
		            		icon: 'warning',
		            		title: '載入類別失敗！',
		            	})
	                });
				
				this.getGoodsListByPage(100,1);//DEMO,只加载第1页
				 
			},
			methods:{
				getGoodsListByPage:function(ps,pno){
					var self = this;
					//按分页检索商品列表
					 this.$http.get('/api/product' +'?pagesize='+ps +'&page=' + pno).then(function(res){
						 self.products=res.body;  
						 //alert(JSON.stringify(self.goods));
		                },function(){
		                	Swal.fire({
			            		icon: 'warning',
			            		title: '載入商品失敗！',
			            	})
		                });
				},
				selectimg:function(el){
					
		            let ppic=el.files[0];
		            let type=ppic.type;//文件的类型，判断是否是图片
		            let size=ppic.size;//文件的大小，判断图片的大小
		            if('image/gif, image/jpeg, image/png, image/jpg'.indexOf(type) == -1){
		            	Swal.fire({
		            		icon: 'error',
		            		title: '格式需求:gif,jpeg,png,jpg',
		            	})
		                
		                return false;
		            }
		            if(size>3145728){
		            	Swal.fire({
		            		icon: 'warning',
		            		title: '容量過載:請選3MB以下之圖片',
		            	})
		                return false;
		            }
		            var uri ='';
		            
		            this.editproduct.cPhoto=URL.createObjectURL(ppic);
				},
				saveproduct:function(p){
					var fileDom=document.getElementById("ppicfile");
					let formData = new FormData();
					formData.append('pId', this.editproduct.pId);
					formData.append('pName', this.editproduct.pName);
					formData.append('pMain', this.editproduct.pMain);
					formData.append('pDetail', this.editproduct.pDetail);
					formData.append('price', this.editproduct.price);
					formData.append('invantory', this.editproduct.invantory);
					formData.append('pSize', this.editproduct.pSize);
					formData.append('description', this.editproduct.description);
					formData.append('sDescription', this.editproduct.sDescription);
					formData.append('cPhoto', fileDom.files[0]);
					formData.append('email', this.editproduct.email);
					formData.append('userName', this.editproduct.userName);
					formData.append('categoryId', this.editproduct.categoryId);
					formData.append('categoryName', this.editproduct.categoryName);
					let config = {
				              headers: {
				                'Content-Type': 'multipart/form-data'
				              }
				            }
					
					  this.$http.post('/api/saveproduct', formData, config).then(function (res) {
						  Swal.fire({
							  title: res.body.msg,
							  html:
							  '<a href="http://localhost:8080/login.html">返回登入頁面</a>',
						  });
			              if(res.body.code==0){
			            	  this.products.unshift(res.body.data);//插入到数组最新面
			            	  this.editproduct={//重新初始化，以便实现清空所有编辑框
			            			pId:null,
			      					pName:null,
			      					pMain:null,
			      					pDetail:null,
			      					price:null,
			      					invantory:null,
			      					pSize:null,
			      					description:null,
			      					sDescription:null,
			      					cPhoto:null,
			      					email:null,
			      					userName:"",
			      					categoryId:1,
			      					lastEditBy:"",
			      					lastEditTime:null
			    				};	
			              }
			            });
				},
				
				
				editproduct:function(p){
					var fileDom=document.getElementById("ppicfile");
					let formData = new FormData();
					formData.set('pId', this.editproduct.pId);
					formData.set('pName', this.editproduct.pName);
					formData.set('pMain', this.editproduct.pMain);
					formData.set('pDetail', this.editproduct.pDetail);
					formData.set('price', this.editproduct.price);
					formData.set('invantory', this.editproduct.invantory);
					formData.set('pSize', this.editproduct.pSize);
					formData.set('description', this.editproduct.description);
					formData.set('sDescription', this.editproduct.sDescription);
					formData.set('cPhoto', fileDom.files[0]);
					formData.set('email', this.editproduct.email);
					formData.set('userName', this.editproduct.userName);
					formData.set('categoryId', this.editproduct.categoryId);
					formData.set('categoryName', this.editproduct.categoryName);
					let config = {
				              headers: {
				                'Content-Type': 'multipart/form-data'
				              }
				            }
					
					  this.$http.post('/api/editproduct', formData, config).then(function (res) {
						  Swal.fire({
							  title: res.body.msg,
							  html:
							  '<a href="http://localhost:8080/login.html">返回登入頁面</a>',
						  });
			              
			            });
				},
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				delproduct:function(p){
					 this.$http.get('/api/delproduct/' + p.pId).then(function(res){
						 Swal.fire({
							  title: res.body.msg
						  })
// 						 alert(res.body.msg); 
						 if(res.body.code==0){
							 this.products.remove(p);
						 }
		                },function(){
		                	Swal.fire({
			            		icon: 'warning',
			            		title: '刪除商品失敗',
			            	})
		                });
				}
			}
		});
	
		
		Array.prototype.remove = function(val) { 
			var index = this.indexOf(val); 
			if (index > -1) { 
			this.splice(index, 1); 
			} 
		};
	</script>
	
</body>
</html>